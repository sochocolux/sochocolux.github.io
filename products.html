<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>So_Chocolux - Our Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Meow+Script&family=UoqMunThenKhung&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfaf6; /* Light cream background */
            color: #331a00; /* Dark brown text */
        }

        .header-font {
            font-family: "Meow Script", cursive;
            font-weight: 400;
            font-style: normal;
        }

        ::-webkit-scrollbar {
            width: none;
        }
        ::-webkit-scrollbar-track {
            background: #f1e7e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #8b4513;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6f360f;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 90%;
            text-align: center;
        }
    </style>
</head>
<body class="antialiased bg-amber-50">

    <!-- Header -->
    <header id="header" class="bg-white shadow-sm py-4 px-6 md:px-12 fixed w-full z-10 duration-300">
        <nav class="container mx-auto flex justify-between items-center">
            <a href="index.html" id="headerName" class="text-3xl font-bold text-amber-900 tracking-wide header-font">So_Chocolux</a>
            <div class="hidden md:flex space-x-8" id="links">
                <a href="index.html" class="text-lg font-medium text-amber-800 hover:text-amber-50 transition duration-300">Home</a>
                <a href="products.html" class="text-lg font-medium text-amber-800 hover:text-amber-50 transition duration-300">Collection</a>
                <a id="show-admin-login-btn" class="cursor-pointer text-lg font-medium text-amber-800 hover:text-amber-50 transition duration-300">
                    Admin Login
                </a>
                <a id="show-add-chocolate-modal-btn" class="text-lg font-medium text-amber-800 hover:text-amber-50 transition duration-300 hidden cursor-pointer">
                    +
                </a>
            </div>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden text-amber-800 focus:outline-none">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </nav>
        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu" class="hidden md:hidden fixed inset-0 bg-amber-950 bg-opacity-95 z-20 flex flex-col items-center justify-center space-y-8">
            <button id="close-mobile-menu" class="absolute top-6 right-6 text-white focus:outline-none">
                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <a href="index.html" class="text-4xl font-bold text-white hover:text-amber-200 transition duration-300" onclick="document.getElementById('mobile-menu').classList.add('hidden')">Home</a>
            <a href="products.html" class="text-4xl font-bold text-white hover:text-amber-200 transition duration-300" onclick="document.getElementById('mobile-menu').classList.add('hidden')">Collection</a>
        </div>
    </header>

    <section id="products" class="duration-300 bg-gradient-t from-amber-50 to-amber-50">
        <!-- User ID Display -->
        <div id="user-info" class="text-center text-amber-800 mb-8 text-opacity-50">
            <p>Loading user...</p>
        </div> 

        <div class="container mx-auto px-6 md:px-12 py-16">
            <h2 class="text-4xl font-bold text-amber-900 text-center mb-12">Our Exquisite Collection</h2>

            <!-- Add New Chocolate Form Overlay -->
            <div id="add-chocolate-modal-overlay" class="modal-overlay hidden">
                <div id="add-chocolate-form-content" class="modal-content bg-white overflow-y-scroll h-[700px] no-scrollbar" style="width: 600px;">
                    <h3 class="text-2xl font-bold text-amber-900 mb-6 text-center">Add New Chocolate</h3>
                    <form id="add-chocolate-form" class="space-y-4">
                        <div>
                            <label for="chocolate-name" class="block text-left text-amber-900 text-lg font-medium mb-2">Chocolate Name</label>
                            <input type="text" id="chocolate-name" name="name" class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-amber-500 focus:border-amber-500 text-amber-900" placeholder="e.g., Raspberry Delight" required>
                        </div>
                        <div>
                            <label for="chocolate-description" class="block text-left text-amber-900 text-lg font-medium mb-2">Description</label>
                            <textarea id="chocolate-description" name="description" rows="3" class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-amber-500 focus:border-amber-500 text-amber-900" placeholder="A rich dark chocolate with a hint of raspberry..." required></textarea>
                        </div>
                        <div>
                            <label for="chocolate-sizes" class="block text-left text-amber-900 text-lg font-medium mb-2">Available sizes</label>
                            <textarea id="chocolate-sizes" name="sizes" rows="3" class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-amber-500 focus:border-amber-500 text-amber-900" placeholder="6 chocolates, $2, 1 bar, $5...(Make sure they are seperated by commas, and the price goes after the name.)" required></textarea>
                        </div>
                        <div>
                            <label for="chocolate-image" class="block text-left text-amber-900 text-lg font-medium mb-2">Image URL</label>
                            <div class="flex justify-between">
                                <input type="url" id="chocolate-image" name="image" class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-amber-500 focus:border-amber-500 text-amber-900" placeholder="https://placehold.co/400x300/8B4513/FFFFFF?text=New+Chocolate">
                                <input type="file" id="upload-image" accept="image/*" class="ml-2 hidden">
                                <button id="upload-image-button" class="bg-gray-300 text-amber-900 mx-2 py-1 rounded-lg font-semibold hover:bg-gray-400 transition duration-300" type="button" onclick="document.getElementById('upload-image').click();">Choose File</button>
                            </div>
                        </div>
                        <div>
                            <label for="chocolate-collection" class="block text-left text-amber-900 text-lg font-medium mb-2">Collection name</label>
                            <input id="chocolate-collection" name="Collection" class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-amber-500 focus:border-amber-500 text-amber-900" placeholder="Please enter a name..."> 
                        </div>
                        <button type="submit" class="w-full bg-amber-700 text-white px-6 py-3 rounded-full font-semibold hover:bg-amber-800 transition duration-300 shadow-md">
                            Add Chocolate
                        </button>
                    </form>
                    <button id="close-add-chocolate-modal-btn" class="w-full mt-4 bg-gray-300 text-gray-800 px-6 py-3 rounded-full font-semibold hover:bg-gray-400 transition duration-300">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-chocolates" class="text-center text-amber-800 text-xl font-semibold hidden">
                Loading chocolates...
            </div>

            <!-- Products Grid -->
            <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <!-- Chocolates will be dynamically loaded here -->
            </div>
        </div>
    </section>

    <!-- Custom Confirmation Modal -->
    <div id="confirmation-modal" class="modal-overlay hidden">
        <div class="modal-content bg-white">
            <p id="modal-message" class="text-amber-900 text-xl mb-6">Are you sure you want to delete this item?</p>
            <div class="flex justify-center space-x-4">
                <button id="modal-confirm-btn" class="bg-red-600 text-white px-6 py-2 rounded-full font-semibold hover:bg-red-700 transition duration-300">Yes</button>
                <button id="modal-cancel-btn" class="bg-gray-300 text-gray-800 px-6 py-2 rounded-full font-semibold hover:bg-gray-400 transition duration-300">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Admin Sign-in Modal -->
    <div id="signin-modal" class="modal-overlay hidden">
        <div class="modal-content bg-white" style="width: 400px;">
            <h3 class="text-2xl font-bold text-amber-900 mb-4">Admin Login</h3>
            <p class="text-amber-800 mb-6">Enter the admin password to manage chocolates.</p>
            <input type="password" id="signin-password-input" class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-amber-500 focus:border-amber-500 text-amber-900 mb-4" placeholder="Password">
            <p id="signin-error-message" class="text-red-500 text-sm mb-4 hidden">Incorrect password. Please try again.</p>
            <button id="signin-button" class="w-full bg-amber-700 text-white px-6 py-3 rounded-full font-semibold hover:bg-amber-800 transition duration-300 shadow-md">
                Login
            </button>
            <button id="signin-cancel-btn" class="w-full mt-2 bg-gray-300 text-gray-800 px-6 py-3 rounded-full font-semibold hover:bg-gray-400 transition duration-300">
                Cancel
            </button>
        </div>
    </div>

    <div id="chocolate-info-modal" class="modal-overlay hidden">
        <div class="modal-content bg-white">
            <div id="chocolate-info-content"></div>
            <div id="sizesContainer" class="flex gap-2 pt-2 flex-nowrap overflow-x-scroll text-nowrap"></div>
            <p id="sizePriceText" class="text-amber-950 text-left">None</p>
        </div>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, deleteDoc, doc, deleteField, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your actual Firebase configuration (Paste the object you copied from Firebase Console here)
        const firebaseConfig = {
            apiKey: "AIzaSyDNDtD7gE3veHw4T8MbY38lt6qbE382uH0",
            authDomain: "sochocoluxwebsite.firebaseapp.com",
            projectId: "sochocoluxwebsite",
            storageBucket: "sochocoluxwebsite.firebasestorage.app",
            messagingSenderId: "804399701912",
            appId: "1:804399701912:web:753f127180945c980095ed",
            measurementId: "G-ZJ4QFZQJQP"
        };

        const ADMIN_PASSWORD = 'ChocolateIsGreat';

        let app;
        let db;
        let auth;
        let currentUserId = null;
        let isAuthReady = false;
        let isAdminLoggedIn = false;

        const productsGrid = document.getElementById('products-grid');
        const addChocolateForm = document.getElementById('add-chocolate-form');
        const loadingChocolates = document.getElementById('loading-chocolates');
        const userInfoDisplay = document.getElementById('user-info');
        const showAdminLoginBtn = document.getElementById('show-admin-login-btn');

        // New UI Elements for Add Chocolate Modal
        const showAddChocolateModalBtn = document.getElementById('show-add-chocolate-modal-btn');
        const addChocolateModalOverlay = document.getElementById('add-chocolate-modal-overlay');
        const closeAddChocolateModalBtn = document.getElementById('close-add-chocolate-modal-btn');

        // Confirmation Modal Elements
        const confirmationModal = document.getElementById('confirmation-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        let confirmActionCallback = null; // To store the callback for the modal confirmation

        // Admin Sign-in Modal Elements
        const signInModal = document.getElementById('signin-modal');
        const signInPasswordInput = document.getElementById('signin-password-input');
        const signInButton = document.getElementById('signin-button');
        const signInErrorMessage = document.getElementById('signin-error-message');
        const signInCancelBtn = document.getElementById('signin-cancel-btn');

        const chocolateInfoModal = document.getElementById('chocolate-info-modal')

        // --- Custom Confirmation Modal Functions ---
        function showConfirmationModal(message, onConfirm) {
            modalMessage.textContent = message;
            confirmActionCallback = onConfirm;
            confirmationModal.classList.remove('hidden');
        }

        function hideConfirmationModal() {
            confirmationModal.classList.add('hidden');
            confirmActionCallback = null;
        }

        modalConfirmBtn.addEventListener('click', () => {
            if (confirmActionCallback) {
                confirmActionCallback();
            }
            hideConfirmationModal();
        });

        modalCancelBtn.addEventListener('click', () => {
            hideConfirmationModal();
        });

        // --- Admin Sign-in Modal Functions ---
        function showSignInModal() {
            signInModal.classList.remove('hidden');
            signInPasswordInput.value = ''; // Clear password field
            signInErrorMessage.classList.add('hidden'); // Hide error message
        }

        function hideSignInModal() {
            signInModal.classList.add('hidden');
        }

        function showChocolateInfo() {
            chocolateInfoModal.classList.remove('hidden')
        }

        function hideChocolateInfo() {
            chocolateInfoModal.classList.add('hidden')
        }

        showAdminLoginBtn.addEventListener('click', showSignInModal);
        signInCancelBtn.addEventListener('click', hideSignInModal);

        signInButton.addEventListener('click', () => {
            const enteredPassword = signInPasswordInput.value;
            if (enteredPassword === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                hideSignInModal();
                showAdminLoginBtn.classList.add('hidden');
                showAddChocolateModalBtn.classList.remove('hidden'); 
                setupRealtimeListener();
            } else {
                signInErrorMessage.classList.remove('hidden');
            }
        });

        showAddChocolateModalBtn.addEventListener('click', () => {
            if (isAdminLoggedIn) {
                addChocolateModalOverlay.classList.remove('hidden');
            } else {
                showSignInModal();
            }
        });

        closeAddChocolateModalBtn.addEventListener('click', () => {
            addChocolateModalOverlay.classList.add('hidden');
        });

        // Close modal when clicking outside the content
        addChocolateModalOverlay.addEventListener('click', (e) => {
            if (e.target === addChocolateModalOverlay) {
                addChocolateModalOverlay.classList.add('hidden');
            }
        });

        // --- Firebase Initialization and Authentication ---
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        userInfoDisplay.textContent = `Logged in as: ${currentUserId}`;
                        isAuthReady = true;
                        setupRealtimeListener(); // Start listening for data once authenticated
                    } else {
                        currentUserId = null;
                        userInfoDisplay.textContent = "Not logged in. Signing in anonymously...";
                        isAuthReady = false;
                        try {
                            await signInAnonymously(auth);
                        } catch (error) {
                            console.error("Error during anonymous sign-in:", error);
                            userInfoDisplay.textContent = `Error signing in: ${error.message}`;
                        }
                    }
                });
            } catch (error) {
                console.error("Failed to initialize Firebase:", error);
                userInfoDisplay.textContent = `Error initializing Firebase: ${error.message}`;
            }
        }

        const IMGBB_API_KEY = '7a6674b9e5baac61f2cc9a3efc15b9dd';

        const uploadImageInput = document.getElementById('upload-image');
        const chocolateImageInput = document.getElementById('chocolate-image');

        uploadImageInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];

            if (!file) {
                return;
            }

            chocolateImageInput.value = ''; // Clear previous URL

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    chocolateImageInput.value = data.data.url;
                    chocolateImageInput.placeholder = 'Image uploaded successfully!';
                } else {
                    console.error('ImgBB API error:', data.error.message);
                    chocolateImageInput.placeholder = 'Upload failed. See console for details.';
                }

            } catch (error) {
                console.error('Error uploading image:', error);
                chocolateImageInput.placeholder = 'An error occurred during upload.';
            } finally {
                if (chocolateImageInput.value === '') {
                    chocolateImageInput.placeholder = 'https://placehold.co/400x300/8B4513/FFFFFF?text=Chocolate';
                }
            }
        });


        function setupChocolateCardClickEvents(chocolate) {
            document.querySelectorAll('#products-grid > div').forEach(card => {
                card.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-chocolate-btn')) return;

                const name = card.querySelector('h3').textContent;
                const img = card.querySelector('img').src;
                const description = card.querySelector('p').textContent;
                const sizesContainer = document.getElementById('sizesContainer')
                const chocolate1 = chocolate.find(item => item.name === name);
                const sizes = chocolate1.sizes.split(',');
                const priceText = document.getElementById('sizePriceText')


                const modalInfo = document.getElementById('chocolate-info-content');
                modalInfo.innerHTML = `
                <strong id="chocolate-info-name" class="text-amber-900 text-xl">${name}</strong>
                <img class="rounded-lg max-w-[350px]" src="${img}">
                 `;

                sizesContainer.innerHTML = ''

                for (let i = 0; i < sizes.length; i += 2) {
                    const sizeBox = document.createElement("div");
                    sizeBox.classList.add("rounded-lg", "bg-gray-300", "nowrap", "px-2", "py-1", "border-gray-400/50", "border-2", "hover:bg-gray-400/70", "hover:border-gray-500/30", "hover:text-amber-900");
                    sizeBox.id = "sizebox-id-" + i;

                    // Set the content of the div to the array element
                    sizeBox.textContent = sizes[i];

                    sizeBox.addEventListener('click', () => {
                        document.querySelectorAll('#sizesContainer .rounded-lg').forEach(box => {
                            if (box !== sizeBox) {
                                box.style.backgroundColor = '#D1D5DB';
                            }
                        });
                        if (sizeBox.style.backgroundColor !== '#9ca3af') {
                            sizeBox.style.backgroundColor = '#9ca3af'
                            const sizeBoxID = sizeBox.id.split('-');
                            const priceID = Number(sizeBoxID[2]) + 1
                            priceText.textContent = sizes[priceID]                            
                        } else {
                            sizeBox.style.backgroundColor = '#D1D5DB'
                            priceText.textContent = ''
                        }


                    });

                    // Append the div to the container
                    sizesContainer.appendChild(sizeBox);
                }

                showChocolateInfo();
                });
             });
            }

            chocolateInfoModal.addEventListener('click', (e) => {
                if (e.target === chocolateInfoModal) {
                hideChocolateInfo();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') hideChocolateInfo();
            });


        // --- Product Rendering and Firebase Operations ---
        function renderChocolates(chocolates) {
            productsGrid.innerHTML = ''; // Clear existing chocolates
            loadingChocolates.classList.add('hidden');

            if (chocolates.length === 0) {
                productsGrid.innerHTML = '<p class="text-center text-amber-700 text-xl col-span-full">No chocolates added yet.</p>';
                return;
            }

            chocolates.forEach(chocolate => {
                let evenNumbers;
                let color;

                if (chocolate.sizes !== undefined && chocolate.sizes !== null) {
                    const unevenArray = chocolate.sizes.split(",");
                    evenNumbers = unevenArray.filter((element, index) => index % 2 === 0);
                    color = 'text-amber-900'
                } else{
                    evenNumbers = 'Archived'
                    color = 'text-gray-400'
                }

                const archiveButtonHtml = isAdminLoggedIn ? 
                `<button data-id="${chocolate.id}" class="archive-chocolate-btn mt-4 bg-gray-300 text-white px-6 py-3 rounded-r-full font-semibold border-gray-400 border-2 hover:bg-gray-400 transition duration-300 shadow-md">
                        Archive
                    </button>` : '';

                const deleteButtonHtml = isAdminLoggedIn ?
                    `<button data-id="${chocolate.id}" class="delete-chocolate-btn mt-4 bg-red-600 text-white px-6 py-3 rounded-l-full font-semibold border-red-700 border-2 hover:bg-red-700 transition duration-300 shadow-md">
                        Delete
                    </button>` : '';

                const fullAdminButtons = isAdminLoggedIn ?
                    `<div class="flex justify-center mb-2">
                        ${deleteButtonHtml}
                        ${archiveButtonHtml}
                    </div>` : ''

                const collection = chocolate.collectionAlbum !== undefined ? `<h5 class="text-xl font-semibold text-amber-900 mb-2">${chocolate.collectionAlbum}</h3>` : ""

                const chocolateCard = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition duration-300 flex flex-col" data-id="${chocolate.id}">
                        <img src="${chocolate.image || 'https://placehold.co/400x300/8B4513/FFFFFF?text=Chocolate'}" alt="${chocolate.name}" class="w-full h-64 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/8B4513/FFFFFF?text=No+Image';">
                        <div class="p-4 flex-grow flex flex-col justify-between">
                            <div>
                                <h3 class="text-2xl font-semibold text-amber-900 mb-2">${chocolate.name}</h3>
                                ${collection}
                                <p class="text-amber-800 mb-2">${chocolate.description}</p>
                            </div>
                            <div>
                                <h4 class="text-2xl font-semibold ${color} mb-1 whitespace-nowrap overflow-hidden">${evenNumbers}</h4>
                            </div>
                        </div>
                        ${fullAdminButtons}
                    </div>
                `;
                productsGrid.insertAdjacentHTML('beforeend', chocolateCard);
            });
            setupChocolateCardClickEvents(chocolates);
        }

        

        function setupRealtimeListener() {
            if (!db || !isAuthReady) {
                console.warn("Firestore not ready or user not authenticated for real-time listener.");
                return;
            }
            loadingChocolates.classList.remove('hidden');
            // Changed collection path to 'chocolates' for consistent local use
            const chocolatesCollectionRef = collection(db, `chocolates`);

            onSnapshot(chocolatesCollectionRef, (snapshot) => {
                const chocolates = [];
                snapshot.forEach(doc => {
                    chocolates.push({ id: doc.id, ...doc.data() });
                });
                renderChocolates(chocolates);
            }, (error) => {
                console.error("Error fetching real-time chocolates:", error);
                loadingChocolates.textContent = `Error loading chocolates: ${error.message}`;
            });
        }

        addChocolateForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!db || !currentUserId || !isAdminLoggedIn) {
                console.error("Cannot add chocolate: Not authenticated as admin or Firestore not initialized.");
                return;
            }

            const name = document.getElementById('chocolate-name').value;
            const description = document.getElementById('chocolate-description').value;
            const sizes = document.getElementById('chocolate-sizes').value;
            const image = document.getElementById('chocolate-image').value;
            const collectionAlbum = document.getElementById('chocolate-collection').value;

            try {
                await addDoc(collection(db, `chocolates`), {
                    name,
                    description,
                    sizes,
                    image,
                    collectionAlbum,
                });
                addChocolateForm.reset();
                addChocolateModalOverlay.classList.add('hidden');
            } catch (error) {
                console.error("Error adding chocolate:", error);
            }
        });

        productsGrid.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-chocolate-btn') && isAdminLoggedIn) {
                const chocolateId = e.target.dataset.id;
                if (chocolateId && db && currentUserId) {
                    showConfirmationModal('Are you sure you want to delete this chocolate?', async () => {
                        try {
                            await deleteDoc(doc(db, `chocolates`, chocolateId));
                            console.log("Chocolate deleted successfully!");
                        } catch (error) {
                            console.error("Error deleting chocolate:", error);
                        }
                    });
                }
            }
        });


        productsGrid.addEventListener('click', (e) => {
            if (e.target.classList.contains('archive-chocolate-btn') && isAdminLoggedIn) {
                const chocolateId = e.target.dataset.id;
                if (chocolateId && db && currentUserId) {
                    showConfirmationModal('Are you sure you want to archive this chocolate?', async () => {
                        try {
                            await updateDoc(doc(db, `chocolates`, chocolateId), {
                                sizes: deleteField()
                            });
                            console.log("Chocolate archived successfully!");
                        } catch (error) {
                            console.error("Error archiving chocolate:", error);
                        }
                    });
                }
            }
        });

        // Initial Firebase setup on window load
        window.onload = initializeFirebase;

        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const closeMobileMenuButton = document.getElementById('close-mobile-menu');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.remove('hidden');
        });

        closeMobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
        });

        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });
        });

        const links = document.getElementById('links')
        const header = document.getElementById('header')
        const headerName = document.getElementById('headerName')
        const products = document.getElementById('products')

        links.addEventListener('mouseenter', () => {
            header.style.backgroundColor = '#451a03';
            headerName.style.color = 'white';
        })

        links.addEventListener('mouseleave', () => {
            header.style.backgroundColor = 'white';
            headerName.style.color = '#78350F';
        })


    </script>

</body>
</html>
